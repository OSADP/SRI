
/*
 * This is the main source file for our dashboard application.
 * Most of the logic here is for initializing the app and nothing
 * more.
 * 
 * @author rothrob
 * 
 * Self triggering function
 */
(function() {
	
	"use strict";
	
	// create a collection of vehicles:
	var vehicles = new App.Collection.Vehicles;
	/*
		load all vehicles and their data from resource
		then() is a promise that when data is loaded the
		views should be created and loaded to our sidebar.
	*/
	vehicles.fetch().then(function() {
		// create our vehicle entries view and pass our collection:
		var vehicleList = new App.View.ListVehicleEntries({ collection: vehicles });
		// render our view:
		vehicleList.render();
		// resize sidebar controls:
		var width = $(".entry-wrapper").css("width");
		$(".truck-entry-controls").css('width', width);
		
		// Construct our Modules:
		// Data Captured Module
		var moduleDataCaptured = new App.View.ModuleView({
			model : vehicles.at(0),
			templateId : "module-data-captured"
		});
		// Overview Module
		var moduleOverview = new App.View.ModuleView({
			model : vehicles.at(0),
			templateId : "module-overview"
		});
		// PrePass Module
		var modulePrePass = new App.View.ModuleView({
			model : vehicles.at(0),
			templateId : "module-prepass",
			childModel: "prePass"
		});
		// Client Information Module
		var moduleClientInfo = new App.View.ModuleView({
			model : vehicles.at(0),
			templateId : "module-carrier-info"
		});
		// Safer Module
		var moduleSafer = new App.View.ModuleView({
			model : vehicles.at(0),
			templateId : "module-safer",
			childModel: "safer"
		});
		// Wim Module
		var moduleWim = new App.View.ModuleView({
			model : vehicles.at(0),
			templateId : "module-wim",
			childModel: "wim"
		});
		// Logger Module
		var moduleLogs = new App.View.ModuleView({
			model : vehicles.at(0),
			templateId : "module-logger"
		});
		// Static Scale Module
		var moduleStaticScale = new App.View.ModuleView({
			model : vehicles.at(0),
			templateId : "module-static-scale",
			childModel: "staticScale"
		});
		// Drivewyze Module
		var moduleDrivewyze = new App.View.ModuleView({
			model : vehicles.at(0),
			templateId : "module-drivewyze",
			childModel: "driveWyze"
		});

		$('#left.column')
			.append( moduleOverview.render().el )
			.append( moduleDataCaptured.render().el )
			.append( moduleWim.render().el );
		
		$('#middle.column')
			.append( moduleClientInfo.render().el )
			.append( moduleSafer.render().el )
			.append( moduleStaticScale.render().el );
		
		$('#right.column')
			.append( modulePrePass.render().el )
			.append( moduleDrivewyze.render().el );
			//.append( moduleLogs.render().el );
		
							
	});
	
})();