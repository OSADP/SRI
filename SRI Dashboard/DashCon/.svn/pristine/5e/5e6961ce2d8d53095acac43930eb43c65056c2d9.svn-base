/**
 * @author rothrob
 * @define App, Backbone
 * @desc   ListSite View
 */	
define(['app', 'backbone'], function(App, Backbone){
	//View for each user	
	App.Views.Site = Backbone.View.extend({
		tagName: 'tr',
		template: template('list-site-template'),
		initialize: function() {
			this.model.on('change', this.render, this);
			this.model.on('destroy', this.remove, this);
		},
		
		events: {
			'click #delete': 'deleteSite',
		},
		
		render: function() {
			var row = this.template(this.model.attributes);
			this.$el.addClass('hover-highlight').html(row);
			return this;
		},
		
		deleteSite: function() {
			var del = confirm("Continue deleting site? This can't be undone.");
			if(del === true)
				this.model.destroy();
		},
		
		remove: function() {
			this.$el.remove();
		}
		
	});
	
	
	//View for list of users
	App.Views.ListSites = Backbone.View.extend({
		el: '#tableBody',
		
		initialize: function() {
			//show loader gif
			this.showLoader();
		},
		
		render: function() {
			this.collection.each(this.addOne, this);
			this.hideLoader();
			return this;
		},
		
		showLoader: function() {
			$("#ajaxLoader").show(0);
		},
		
		hideLoader: function() {
			$("#ajaxLoader").fadeOut();
		},
		
		addOne: function(site) {
			var siteView = new App.Views.Site({model: site});
			this.$el.append(siteView.render().el);
			return this;
		}
	});
	
	return App;
	
});