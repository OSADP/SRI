<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Site Setup</title>

<link rel="stylesheet"
	href="./vendor/ui-framework/bootstrap/css/prettify.css" />
<link rel="stylesheet"
	href="./vendor/ui-framework/bootstrap/css/bootstrap.css" />
<link rel="stylesheet"
	href="./vendor/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="./css.deleteStyle.css" />



<script
	src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDuC2pp8NMpPeKnDwWQBtybj4RV__O0DdA&libraries=weather&sensor=false"
	type="text/javascript">
	
</script>
<script
	src="http://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.min.js"
	type="text/javascript"></script>


<!-- jQuery Framework -->
<script type="text/javascript" src="./js/jquery-1.11.0.js"></script>
<script type="text/javascript"
	src="./vendor/ui-framework/bootstrap/js/google-code-prettify/prettify.js"></script>

<!-- javascript components for other functionalities -->
<!-- adds placeholder for browsers that does not support it in default -->
<script type="text/javascript"
	src="./vendor/ui-framework/js/jquery.placeholder.js"></script>

<style type="text/css">
* {
	box-sizing: border-box;
}

.container { 
	width:100%;
/*     padding-top:80px; */
	padding-left:10px;
    z-index:5;
    overflow:auto;
/*     margin-top:100px; */
	align:center;
}

.form-register {
	width: 320px;
}

#header {
	padding: 8px 10px;
	border-radius: 5px;
	border: #BBB solid 2px;
/* 	cursor: pointer; */
/* 	-webkit-appearance: menulist !important; */
	text-align: center;
	display:block;
	z-index:10;
	width:100%;
	background-color:#000012;
	position:fixed;
	
	
	/* fixes missing arrow button in chrome */
}

select:hover {
	border-color: #2ecc71;
}

label {
	margin-bottom: 0px !important;
}

class {
	padding: 8px 10px;
	border-radius: 5px;
	border: #BBB solid 2px;
}

label>span {
	color: #e74c3c;
}

.instruction-text {
	font-size: 14px;
	color: #e74c3c;
}

.error-msg {
	margin-left: 4px;
}

li {
    display: inline;
}
</style>
</head>
<body>
	<div class="navbar navbar-fixed-top visible-phone">
		<div id="header">
		<h2>Site Setup Page</h2>
		<div class="navbar-inner"></div>
		<div>

			<div class="nav-collapse">
				<ul class="nav">
					<font size=2>
						<li><a href="/">Home</a></li>
						<li><a href="/portfolio"> Portfolio</a></li>
						<li><a href="/services"> Services</a></li>
						<li><a href="/contact"> Contact Us</a></li>
					</font>
				</ul>
			</div>
		</div>
	</div>
	</div>
	
<div class="container">
<form id="deleteForm">
		<div id="deleteForm">
			<div class="form-group">
				Insert Site Name<br>
				<input type="text" id="siteName" class="form-control validate"
					title="Insert Site Name" placeholder="Insert the site id of the site to be used" />
			</div>
		</div>

		<div id="deleteForm">
				Insert Site ID<br>
				 <input	type="text" id="siteId" class="form-control validate"
					placeholder="Insert the site id of the site to be used" /><br><br>
		</div>

		<div class="form-group">
			State:<br>
			 <select name="State"
				id="stateId" class="form-control validate">
				<option value="">Click to Select</option>
			</select>
		</div>

		<div id="deleteForm">
					Please describe the site <br>
					<textarea  name="comments" maxlength="1000" cols="25" rows="6"></textarea>
		</div>

		<div id="deleteForm">
				Site latitude:<br>
				<p id="latitude"></p><br>
		</div>

		<div id="deleteForm">
				Site longitude:<br>
				<p id="longitude"></p><br>
		</div>

		<button onclick="getLocation()">Push to get Location</button>

		<div class="form-group">
			<label>Choose the number of devices for the site</label> <select
				name="deviceNumbers" id="mySelect" onchange="getVendor()">
				<option default value="1">1</option>
				<option value="2">2</option>
				<option value="3">3</option>
				<option value="4">4</option>
				<option value="5">5</option>
				<option value="6">6</option>
				<option value="7">7</option>
			</select>
		</div>

		<div class="form-group">
			<div id="repeatDiv">
				<div id="copy">
					<label for="deviceVendor">Select Vendor(s)</label><br> <select
						id="deviceVendor" onchange="onChangeGetDevice()">
						<option default></option><br><br>
					</select> <br><label form="device">Select Device(s)</label><br> <select id="device">
						<option default></option>
					</select>
				</div>
			</div>
		</div>

		<div class="form-group">
			<div id="siteTypeIdDiv">
				<div id="copy">
					<label form="siteTypeId" id="siteTypeId">Select the type of
						the site</label> <select>
						<option default></option>
						<option>1234</option>
						<option>2234</option>
						<option>3234</option>
						<option>4234</option>
					</select>
				</div>
			</div>

		<button type="button" id="btnSubmit"
			class="btn btn-wide btn-embossed btn-primary">Add Site</button>
		<button type="button" id="btnReset"
			class="btn btn-wide btn-embossed btn-default">Reset Form</button>
	</div>
	
	</form>
	</div>
	<script>
		// validation
		var siteName = $('#siteName').val;
		var siteId = $('#siteId').val;
		var stateId = $('#stateId').val;
		var siteDescription = $('#siteDescription').val;
		var lat = $('#lat').val;
		var lng = $('#lng').val;
		var deviceVendor = $('#deviceVendor').val;
		var device = $('#device').val;
		var siteTypeId = $('#siteTypeId').val;

		var site = {
			siteId : $('#siteId').val(),
			stateId : $('#stateId').val(),
			siteName : $('#siteName').val(),
			siteDescription : $('#siteDescription').val(),
			lat : $('#lat').val(),
			lng : $('#lng').val(),
			//sitetype id needs to be associated
			siteTypeId : $('#siteTypeId').val()
		};

		var device = {
			device : $('#device')
		};

		var deviceVendorName = {
			deviceVendorName : $('deviceVendor')
		};

		var inputValidation = function() {

			if (siteName == '') {
				alert('Please enter a site name.').parent().css('color',
						'#e74c3c');
			}
			// 		else {
			// 			$el.hasSuccess();
			// 		}

			if (siteId == '') {
				alert('Please enter a site id').parent()
						.css('color', '#e74c3c');
			}
			// 		else {
			// 			$el.hasSuccess();
			// 		}	
			if (statId == '') {
				alert('Please enter a site name.').parent().css('color',
						'#e74c3c');
			}
			// 		else {
			// 			$el.hasSuccess();
			// 		}		
			if (siteDescription == '') {
				alert('Please enter a site name.').parent().css('color',
						'#e74c3c');
			}
			// 		else {
			// 			$el.hasSuccess();
			// 		}		
			if (siteName == '') {
				alert('Please enter a site name.').parent().css('color',
						'#e74c3c');
			}
			// 		else {
			// 			$el.hasSuccess();
			// 		}		
			if (siteName == '') {
				alert('Please enter a site name.').parent().css('color',
						'#e74c3c');
			}
			// 		else {
			// 			$el.hasSuccess();
			// 		}		
			if (siteName == '') {
				alert('Please enter a site name.').parent().css('color',
						'#e74c3c');
			}
			// 		else {
			// 			$el.hasSuccess();
			// 		}		
			if (siteName == '') {
				alert('Please enter a site name.').parent().css('color',
						'#e74c3c');
			}
			// 		else {
			// 			$el.hasSuccess();
			// 		}		
			if (siteName == '') {
				alert('Please enter a site name.').parent().css('color',
						'#e74c3c');
			}
			// 		else {
			// 			$el.hasSuccess();
			// 		}		
		};

		$(function() {
			$('#siteId').on('input', function() {
				$(this).validate({
					minLength : 11,
					maxLength : 11
				});
				validateVendor();
			});

			var validateVendor = $(function($this) {
				var validate = new Object();
				validate.deviceVendor = $this.val();

				vendorName = $.ajax({
					url : 'resources/device/allDevicesByVendor',
					contentType : 'application/json',
					type : 'POST',
					data : JSON.stringify(validate),
					success : function(data) {
						alert("site " + $("#site").val() + " was added");
					},
					error : function(data) {
						alert("No " + $("#site").val() + " found");
					}
				});
			});
		});

		// 		submit function
		$("#btnSubmit").on('click', function(event) {
			event.preventDefault();
			confirmation();

		});

		// database calls 
		function confirmation() {
			var r = confirm("Are you sure you want to add site "
					+ $("#userId").val() + " ?");

			var s = mySelect.val;

			for (s; s > 0; s--) {

				// 					var device = {

				// 					};
			}
			if (r == true) {

				$.post({
					url : 'resources/site/insert/',
					contentType : 'application/json',
					type : 'POST',
					data : JSON.stringify(site),
					success : function(data) {
						alert("site " + $("#site").val() + " was added");
					},
					error : function(data) {
						alert("No " + $("#site").val() + " found");
					}
				});
			}
		};

		// json file loader for states
		$.getJSON('./js/states.json', statesLoader);

		function statesLoader(data) {
			$.each(data, function(abbr, name) {
				$('#stateId').append(
						'<option value="' + abbr + '">' + name + '</option>');
			});
		}

		// load vendor drop down with vendors
		$(function getVendor() {
			if (document.getElementById("repeatDiv")) {
				$.ajax({
					url : 'resources/vendor',
					contentType : 'application/json',
					dataType : 'json',
					type : 'GET',
					success : function(id) {
						populateVendor(id.vendor);
					},
					error : function() {
						alert("not working correctly darn");
					}
				});
			}
		});

		function populateVendor(id) {

			$.each(id, function(index, v) {
				$("#deviceVendor").append(
						'<option value="'+ v.vendorName +'">' + v.vendorName
								+ '</option>');
			});
		}

		// this drives the number of devices that a user chooses
		$("#mySelect").on(
				'change',
				function() {

					var value = jQuery(this).val();
					var $repeatDiv = jQuery("#repeatDiv");
					if (document.getElementById("repeatDiv1")) {
						for (var i = 0; i <= 7; i++) {
							$("#repeatDiv" + i).remove();
						}
					}
					for (var i = 1; i < value; i++) {
						$repeatDiv.after($repeatDiv.clone().attr("id",
								"repeatDiv" + i));
					}
				});

		//create onchage event function 
		function onChangeGetDevice() {
			var getter = document.getElementById("deviceVendor");
			var vendor = getter.options[getter.selectedIndex].value;

			$.ajax({
				url : 'resources/device/allDevicesByVendor/' + vendor,
				contentType : 'application/json',
				dataType : 'json',
				type : 'GET',
				success : function(data) {

					populateDevice(data.device);

					//populateDevice(data);
				},
				error : function(data) {
					alert("device is not working correctly "
							+ JSON.stringify(data));
				}
			});
		}

		function populateDevice(id) {
			if (document.getElementById("deviceSelection")) {
				while (document.getElementById("deviceSelection")) {
					$("#deviceSelection").remove();
				}
			}

			if (id instanceof Array) {
			} else {
				id = new Array(id);
			}
			$.each(id, function(index, v) {
				$("#device").append(
						'<option value="'+ v.deviceId +'" id=deviceSelection >'
								+ v.deviceName + '</option>');
			});

		}

		// get current location 
		function getLocation() {
			if (navigator.geolocation) {
				navigator.geolocation.getCurrentPosition(showPosition);
			} else {
				alert("Geolocation is not supported");
			}
		}
		// function to display lat and lon of the users site
		function showPosition(position) {
			var lat = position.coords.latitude;
			var lng = position.coords.longitude;
			document.getElementById("latitude").innerHTML = lat;
			document.getElementById("longitude").innerHTML = lng;
			//map.setCenter(new google.maps.LatLng(lat, lng));
		}
	</script>
</body>
</html>