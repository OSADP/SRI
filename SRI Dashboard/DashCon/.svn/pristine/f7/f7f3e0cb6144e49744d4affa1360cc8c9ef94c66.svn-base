

'use strict';


angular.module('sri.controller.Safer.CompanyData', [])
	.controller('CompanyDataCTRL', ['$scope', '$http', '$timeout', function( $scope, $http, $timeout ) {
		$scope.truck = $scope.truck || {};
		$scope.safer = $scope.safer || {};
		$scope.safer.data = $scope.truck.current.safer;
		
//		$scope.$on('truckFeedNew', function( event, data ) {
//			if( data == '' || data == 'null' || data == undefined || data.usdotNumber == undefined ) {
//				$scope.safer.data = '';
//			} else {
//				$http.get('/DashCon/resources/safer/' + data.usdotNumber )
//					.success( loadSafer )
//					.error( function( res ) {
//						$scope.safer.data = null;
//						$scope.safer.loading = false;
//					});
//			}
//		});
		
		$scope.$on('truckPhoneActive', function( event, data ) {
			if( data == '' || data == 'null' || data == undefined || data.usdotNumber == undefined ) {
				$scope.safer.data = '';
			} else {
				$scope.safer.loading = true;
				$http.get('/DashCon/resources/safer/' + data.usdotNumber )
					.success( loadSafer )
					.error( function( res ) {
					 	$scope.safer.data = null;
					 	$scope.safer.loading = false;
					});
			}
		});
		
		$scope.$on('saferLookupSuccess', function( event, data ) {
			$scope.safer.data = data;
		});
		
		function loadSafer( data ) {
			$scope.safer.data = data;
			$scope.safer.loading = false;
//			$timeout(function() {
//				$scope.safer.loading = false;
//			}, 1200);
			
			if( data == "" || data == undefined || data == null ) return false;
			
		}
	}]);