

'use strict';


angular.module('sri.controller.Safer.CompanyData', [])
	.controller('CompanyDataCTRL', ['$scope', '$http', '$timeout', '$rootScope', function( $scope, $http, $timeout, $rootScope ) {
		$scope.truck = $scope.truck || {};
		$scope.safer = $scope.safer || {};
		$scope.safer.data = $scope.truck.current.safer;
		
		$scope.$on('truckPhoneActive', function( event, data ) {
			if( data == '' || data == 'null' || data == undefined || data.usdotNumber == undefined ) {
				loadSafer( data );
			} else {
				$scope.safer.loading = true;
				$http.get('/DashCon/resources/safer/' + data.usdotNumber )
					.success( loadSafer )
					.error( function( res ) {
					 	$scope.safer.data = null;
					 	$scope.safer.loading = false;
					});
			}
		});
		
		$scope.$on('saferLookupSuccess', function( event, data ) {
			$scope.safer.loading = true;
			loadSafer( data );
			//if( data == "" || data == undefined || data == null ) return false;
		});
		
		function loadSafer( data ) {
			$scope.safer.data = data;
			$rootScope.$broadcast('saferDataLoaded', data);
			$scope.safer.loading = false;
		}
	}]);