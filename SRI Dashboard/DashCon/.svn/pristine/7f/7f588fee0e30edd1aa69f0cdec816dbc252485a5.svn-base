/**
 * @author rothrob
 * @define App, Backbone
 * @desc   List Users View
 */	
define(['backbone'], function(Backbone){
	//View for each user	
	var UserView = Backbone.View.extend({
		tagName: 'tr',
		template: template('list-user-template'),
		initialize: function() {
			this.model.on('change', this.render, this);
			this.model.on('destroy', this.remove, this);
		},
		
		events: {
			'click #delete': 'deleteUser',
		},
		
		render: function() {
			var row = this.template(this.model.attributes);
			this.$el.addClass('hover-highlight').html(row);
			return this;
		},
		
		deleteUser: function() {
			var del = confirm("Continue deleting user? This can't be undone.");
			if(del === true)
				this.model.destroy();
		},
		
		remove: function() {
			this.$el.remove();
		}
		
	});
	
	
	//View for list of users
	var ListUsers = Backbone.View.extend({
		el: '#tableBody',
		
		initialize: function() {
			this.showLoader();
		},
		
		render: function() {
			this.collection.each(this.addOne, this);
			this.hideLoader();
			return this;
		},
		
		showLoader: function() {
			$("#ajaxLoader").show(0);
		},
		
		hideLoader: function() {
			$("#ajaxLoader").fadeOut();
		},
		
		addOne: function(user) {
			var userView = new UserView({model: user});
			this.$el.append(userView.render().el);
			return this;
		}
	});
	
	return ListUsers;
	
});